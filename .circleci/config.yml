# Use Circle CI Version 2.1 - Illustrate usage of Orb
version: 2.1

# Start - 
orbs:   
  aws-ecr: circleci/aws-ecr@6.15.3
  aws-ecs: circleci/aws-ecs@2.0.0

workflows:
  build-and-deploy-docker-image:
    jobs:
      - job-name1
      - slack/notify:
          channel: ramesh.raj@aremedia.com.au
          event: pass
          template: basic_success_1
      - aws-ecr/build-and-push-image:
          account-url: AWS_ECR_ACCOUNT_URL
          aws-access-key-id: AWS_ACCESS_KEY_ID
          aws-secret-access-key: AWS_SECRET_ACCESS_KEY
          profile-name: profile1
          region: AWS_DEFAULT_REGION          
          repo: nonprod-test-nowsite-1                  
          create-repo: false
          dockerfile: Dockerfile
          no-output-timeout: 20m
          skip-when-tags-exist: true
          tag: 'latest,myECRRepoTag'
          requires:
            - job-name1
            
jobs:  
  job-name1:
    machine: 
      image: ubuntu-2004:202101-01
    steps:
      - run: echo "This Job Collects VM Info: Linux"
      - run: pwd; id; uname -a;   
    
    
    # End
